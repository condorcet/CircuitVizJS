"use strict";if(CircuitViz)throw new Error('namespace "CircuitViz" already exists!');var CircuitViz={};CircuitViz.events={},CircuitViz.digraph={},CircuitViz.model={},CircuitViz.visualization={},function(){CircuitViz.digraph.Arc=function(a,b){this.id=CircuitViz.digraph.Arc._nextId,CircuitViz.digraph.Arc._nextId++,this.srcVertex=a,this.rcvVertex=b,this._amperage};var a=CircuitViz.digraph.Arc;a.prototype.getId=function(){return this.id},a.prototype.reverse=function(){var a=srcVertex;this.srcVertex=this.rcvVertex,this.rcvVertex=a},a.prototype.setAmperage=function(a){this._amperage=a},a.prototype.getAmperage=function(){return this._amperage},a.prototype.toString=function(){return"arc "+this.id},a._nextId=1}(),function(){CircuitViz.digraph.Vertex=function(){this.id=CircuitViz.digraph.Vertex._nextId,CircuitViz.digraph.Vertex._nextId++,this.listOfArcs=[]};var a=CircuitViz.digraph.Vertex;a.prototype.getId=function(){return this.id},a.prototype.addArc=function(a){this.listOfArcs[a.toString()]=a},a.prototype.toString=function(){return"vertex "+this.id},a._nextId=1}(),function(){CircuitViz.digraph.Digraph=function(){this.listOfVertex={},this.listOfArcs={}};var a=CircuitViz.digraph.Digraph;a.prototype.addVertex=function(){var a=new CircuitViz.digraph.Vertex;return this.listOfVertex[a.toString()]=a,a},a.prototype.addArc=function(a,b){var c=new CircuitViz.digraph.Arc(a,b);return this.listOfArcs[c.toString()]=c,a.addArc(c),b.addArc(c),c},a.prototype.removeVertex=function(a){if("number"==typeof a){var b;for(var c in listOfVertex)if(b=listOfVertex[c],b.getId()==a){for(var d in b.listOfArcs)this.removeArc(b.listOfArcs[d]);delete this.listOfVertex[b.toString()],b=null;break}}else if(a instanceof CircuitViz.digraph.Vertex){for(var d in a.listOfArcs)this.removeArc(a.listOfArcs[d]);delete this.listOfVertex[a.toString()]}},a.prototype.removeArc=function(a){var b,c,d;if(a instanceof CircuitViz.digraph.Arc)b=a,c=b.srcVertex,d=b.rcvVertex,delete c.listOfArcs[b.toString()],delete d.listOfArcs[b.toString()],delete this.listOfArcs[b.toString()];else if("number"==typeof a){for(var e in this.listOfArcs)if(this.listOfArcs[e].getId()==a){b=this.listOfArcs[e];break}c=b.srcVertex,d=b.rcvVertex,delete c.listOfArcs[b.toString()],delete d.listOfArcs[b.toString()],delete this.listOfArcs[b.toString()]}},a.prototype.connectToArc=function(a,b){a.rcvVertex=b.srcVertex}}(),function(){CircuitViz.events.EventDispatcher={listeners:{},addEventListener:function(a,b){this.listeners||(this.listeners={}),this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},removeEventListener:function(a,b){var c=this.listeners&&this.listeners[a];if(c)for(var d=0;d<c.length;d++)c[d]==b&&c.splice(d--,1)},dispatchEvent:function(a){if(this.listeners&&this.listeners[a.type]){a.target=this;for(var b=this.listeners[a.type],c=0;c<b.length;c++)b[c].apply(this,[].slice.call(arguments,0))}}}}(),function(){CircuitViz.events.BaseModelEvent=function(a){this.type=a};var a=CircuitViz.events.BaseModelEvent;a.CHANGE_VALUE="Change value",a.CHANGE_SIGN="Change sign"}(),function(){CircuitViz.events.OutputEvent=function(a){this.type=a};var a=CircuitViz.events.OutputEvent;a.CHANGE_VALUE="Change value",a.CHANGE_SIGN="Change sign"}(),function(){CircuitViz.model.Output=function(a){a||(this.name=a),this._value};var a=CircuitViz.model.Output,b=CircuitViz.events.EventDispatcher,c=CircuitViz.events.OutputEvent;a.prototype.setValue=function(a){if(this._value!=a){this._value=a;var b=new c(c.CHANGE_VALUE);this.dispatchEvent(b)}},a.prototype.getValue=function(){return this._value};for(var d in b)a.prototype[d]=b[d]}(),function(){var a=CircuitViz.model.Output,b=CircuitViz.events.OutputEvent,c=CircuitViz.events.BaseModelEvent;CircuitViz.model.BaseModel=function(){this.time=new a,this._listOfOutputs={},this._listOfChangedValue=[],this._listOfChangedSign=[]};var d=CircuitViz.model.BaseModel;d.prototype.addOutput=function(a){function c(a){this._listOfChangedValue.push(a.target)}this._listOfOutputs[a]||a.addEventListener(b.CHANGE_VALUE,c)},d.prototype.updateEvents=function(){0!=this._listOfChangedValue.length&&this.dispatchEvent(new c(c.CHANGE_VALUE)),this._listOfChangedValue=[],this._listOfChangedSign=[]},d.prototype.getListOfOutputs=function(){return this._listOfOutputs},d.prototype.getListOfChangedValue=function(){return this._listOfChangedValue},d.prototype.getListOfChangedSign=function(){return this._listOfChangedSign},d.prototype.getTime=function(){return this.time.getValue()},d.prototype.addTime=function(a){this.time.getValue()?this.time.setValue(this.time.getValue()+a):this.time.setValue(a)},d.prototype.resetTime=function(){this.time.setValue(0)}}(),function(){CircuitViz.visualization.VisualError=function(b){Error.call(this,b),this.name="VisualError",this.property=b,this.message="Visualization error: "+b,Error.captureStackTrace?Error.captureStackTrace(this,a):this.stack=(new Error).stack};var a=CircuitViz.visualization.VisualError;a.prototype=Object.create(Error.prototype)}(),function(){CircuitViz.visualization.Particle=function(a,b){createjs.Container.apply(this,arguments),this.id=CircuitViz.visualization.Particle._count++,this._draw(),this.x=a,this.y=b,this._offset=0,this._segment};var a=CircuitViz.visualization.Particle;a.prototype=Object.create(createjs.Container.prototype),a.prototype.constructor=a,a.prototype.move=function(a){this._offset+=a,this.x=this._segment.getPoint1().x+Math.cos(this._segment.getAngle())*this._offset,this.y=this._segment.getPoint1().y+Math.sin(this._segment.getAngle())*this._offset},a.prototype.setSegment=function(a){this._segment=a,this._offset=0},a.prototype.getSegment=function(){return this._segment},a.prototype.getOffset=function(){return this._offset},a.prototype.setOffset=function(a){this._offset=a},a.prototype._draw=function(){var b="#FA0000";for(var c in this.children)this.removeChild(this.children[c]);if(this._debugMode){var d=createjs.Text(this.id);this.addChild(d),this._firstParticle&&(b="#0000FA")}var e=(new createjs.Graphics).s("#AF0000").f("#ff0000").dc(0,0,a.particleWidth/2).ef(),f=new createjs.Shape(e);this.addChild(f)},a.prototype.checkFirst=function(a){this._debugMode&&(this._firstParticle=a),this._draw()},a._count=0,a.particleWidth=5,a._debugMode=!1,a._firstParticle=!1}(),function(){CircuitViz.visualization.Segment=function(a,b){this._point1,this._point2,this._angle,this._length,this.id=this._id,this._id++,this.setPoints(a,b)};var a=CircuitViz.visualization.Segment;a.prototype.getLength=function(){return this._length},a.prototype.getAngle=function(){return this._angle},a.prototype.setPoints=function(a,b){this._point1=a,this._point2=b,this._calcAngle(),this._calcLength()},a.prototype.setPoint1=function(a){this._point1=a,this._calcAngle(),this._calcLength()},a.prototype.setPoint2=function(a){this._point2=a,this._calcAngle(),this._calcLength()},a.prototype.getPoint1=function(){return this._point1},a.prototype.getPoint2=function(){return this._point2},a.prototype._calcAngle=function(){this._angle=Math.atan2(this._point2.y-this._point1.y,this._point2.x-this._point1.x)},a.prototype._calcLength=function(){this._length=Math.sqrt(Math.pow(this._point2.x-this._point1.x,2)+Math.pow(this._point2.y-this._point1.y,2))}}(),function(){function a(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}var b=CircuitViz.visualization.Particle;CircuitViz.visualization.Chain=function(a){createjs.Container.apply(this,arguments),a?this._listOfSegments=a:this._listOfSegments=[],this._particleBuffer=[],this.id=CircuitViz.visualization.Chain._id,CircuitViz.visualization.Chain._id++,this._deltaDistance=20,this._listOfparticles,this._speed,this._speedDefined=!1,this._enableBuffer=!0,this._chainLength=0,this._minLength,this._firstParticle};var c=CircuitViz.visualization.Chain;c.prototype=Object.create(createjs.Container.prototype),c.prototype.constructor=c,c._id=0,c.prototype.addSegment=function(a){for(var b=0;b<this._listOfSegments.length;b++)if(this._listOfSegments[b]==a)return;this._listOfSegments.push(a)},c.prototype.removeSegments=function(){this._listOfSegments=null,this.removeParticles()},c.prototype.createParticles=function(){this._listOfparticles&&this.removeParticles(),this._listOfParticles=[];var c,d,e=0,f=0;c=new b(0,0),this._firstParticle=c,c.checkFirst(!0),this._minLength=this._listOfSegments[0].getLength();for(var g=0;g<this._listOfSegments.length;g++){for(d=this._listOfSegments[g],this._chainLength+=d.getLength(),this._minLength>d.getLength()&&(this._minLength=d.getLength()),c.setSegment(d),c.move(e),f=1;Math.abs(a(d.getPoint1(),{x:c.x,y:c.y})+a({x:c.x,y:c.y},d.getPoint2())-d.getLength())<.1;)this._listOfParticles.push(c),this.addChild(c),c=new b(0,0),c.setSegment(d),c.move(f*this._deltaDistance+e),f++;e=a({x:c.x,y:c.y},d.getPoint2())}},c.prototype.removeParticles=function(){for(var a=0;a<this._listOfParticles.length;a++)this.removeChild(this._listOfParticles[a]);this._listOfParticles=null},c.prototype.nextStep=function(){if(this._speedDefined){var b,c,d,e,f,g=0;if(this._enableBuffer&&0!=this._particleBuffer.length){c=this._listOfSegments[0];var g=this._firstParticle.getOffset()-this._deltaDistance;if(this._speed<0&&(g=c.getLength()-this._firstParticle.getOffset()-this._deltaDistance),g>=0){f=this._particleBuffer.pop(),b=f.particle;var h=f.adress;b.setSegment(c),b.move(this._firstParticle.getOffset()-this._deltaDistance*this._speed/Math.abs(this._speed)),this._firstParticle.checkFirst(!1),this._firstParticle=b,this._firstParticle.checkFirst(!0),this._listOfParticles[h]=b,b.visible=!0}}for(var i=0;i<this._listOfParticles.length;i++)if(b=this._listOfParticles[i],null!=b)if(c=b.getSegment(),d=Math.cos(c.getAngle())*this._speed,e=Math.sin(c.getAngle())*this._speed,b.getOffset()+this._speed>=0&&b.getOffset()+this._speed<=c.getLength())b.move(this._speed);else{var j,k=!1;for(j=0;j<this._listOfSegments.length;j++)if(this._listOfSegments[j]==c){k=!0;break}var l=c;if(j+1<=this._listOfSegments.length-1)c=this._listOfSegments[j+1];else if(c=this._listOfSegments[0],this._enableBuffer){f=new Object,f.particle=b,f.adress=i,this._particleBuffer.push(f),b.visible=!1,this._listOfParticles[i]=null,b.setSegment(c);continue}b.setSegment(c),this._speed<0?(g=a(l.getPoint1(),{x:b.x+d,y:b.y+e}),b.move(c.getLength()-g)):(g=a(l.getPoint2(),{x:b.x+d,y:b.y+e}),b.move(g))}}},c.prototype.setSpeed=function(a){(this._speedDefined&&(this._speed*a<0||0==this._speed&&(0>a||a>0))||!this._speedDefined&&0>a)&&null!=this._listOfParticles&&this._changeSpeed(a),this._speedDefined=!0,0==a&&(this._speedDefined=!1,this._speed<0&&this._changeSpeed(.1)),this._speed=a},c.prototype._changeSpeed=function(a){var b=this._findLastParticle(a);this._firstParticle.checkFirst(!1),this._firstParticle=b,this._firstParticle.checkFirst(!0),this._listOfSegments.reverse()},c.prototype.getSpeed=function(){return speed},c.prototype._findLastParticle=function(a){var b=this._listOfSegments[this._listOfSegments.length-1],c=b.getLength(),d=b.getLength();a>0&&(c=0);for(var e,f=0;f<this._listOfParticles.length;f++)null!=this._listOfParticles[f]&&this._listOfParticles[f].getSegment().id==b.id&&Math.abs(c-this._listOfParticles[f].getOffset())<=d&&(d=Math.abs(c-this._listOfParticles[f].getOffset()),e=this._listOfParticles[f]);return e},c.prototype.setDeltaDistance=function(a){this._deltaDistance=a}}(),function(){function a(a){return function(b){for(var c in a._listOfChains)a._listOfChains[c].nextStep()}}function b(a){return function(b,c){a._listOfChanged.push(b.target),a.update()}}var c=CircuitViz.visualization.VisualError,d=CircuitViz.events.OutputEvent,e=CircuitViz.visualization.Chain,f=CircuitViz.visualization.Segment,g=CircuitViz.events.EventDispatcher;CircuitViz.visualization.Visualization=function(a){createjs.Container.apply(this,arguments),this._deltaDistance=20,this._listOfChains={},this._listOfChanged=[],this._digraph,this._arcs=[],this._baseAmperage=.05,this._visualState=CircuitViz.visualization.Visualization.VISUAL_NONE,this.setDigraph(a)};var h=CircuitViz.visualization.Visualization;h.prototype=Object.create(createjs.Container.prototype),h.prototype.constructor=h,h.prototype.setDigraph=function(a){if(this._visualState!=h.VISUAL_NONE)throw new c("Cannot set digraph after start visual");a&&(this._digraph=a,this._addListeners())},h.prototype.addChain=function(a,b){if(this._visualState!=h.VISUAL_NONE)throw new c("Cannot add chain after start visual");if(a&&b&&!(b.length<2)){for(var d,g=new e,i=0;i<b.length-1;i++)d=new f(b[i],b[i+1]),g.addSegment(d),g.setDeltaDistance(this._deltaDistance);this._arcs[a]=a,this._listOfChains[a]=g,g.createParticles(),this.addChild(g)}},h.prototype.clear=function(){for(;this.numChildren>0;)this.removeChildAt(0);this._removeListeners(),this._digraph=null,this._listOfChanged=null,this._listOfChains=null,this._visualState=h.VISUAL_NONE},h.prototype.update=function(a){if(this._visualState==h.VISUAL_NONE)throw new c("Vis not started yet");if(this._visualState!=h.VISUAL_STOPPED&&this._visualState!=h.VISUAL_ERROR)if(1==a)for(var b in this._listOfChains){var d=this._arcs[b].getAmperage();Math.abs(d.getValue())>=this._baseAmperage&&console.log("warning: strobe effect on arc "+b),this._listOfChains[b].setSpeed(d.getValue()/this._baseAmperage*this._deltaDistance/2)}else{for(var e=0;e<this._listOfChanged.length;e++)for(var b in this._listOfChains){var d=this._arcs[b].getAmperage();Math.abs(d.getValue())>=this._baseAmperage&&console.log("warning: strobe effect on arc "+b),d==this._listOfChanged[e]&&this._listOfChains[b].setSpeed(d.getValue()/this._baseAmperage*this._deltaDistance/2)}this._listOfChanged=[]}},h.prototype.start=function(){this._visualState==h.VISUAL_NONE&&(this._visualState=h.VISUAL_STARTED,createjs.Ticker.addEventListener("tick",a(this)))},h.prototype.pause=function(){if(this._visualState==h.VISUAL_NONE)throw new c("Vis not started yet");this._visualState==h.VISUAL_STARTED&&(createjs.Ticker.removeEventListener("tick",a(this)),this._visualState=h.VISUAL_PAUSED)},h.prototype.resume=function(){this._visualState==h.VISUAL_PAUSED&&(this._visualState=h.VISUAL_STARTED,createjs.Ticker.addEventListener("tick",a(this)))},h.prototype.stop=function(){if(this._visualState==h.VISUAL_NONE)throw new c("Vis not started yet");createjs.Ticker.removeEventListener("tick",a(this)),this._visualState=h.VISUAL_STOPPED},h.prototype._animate=function(a){for(var b in this._listOfChains)this._listOfChains[b].nextStep()},h.prototype._addListeners=function(){var a;for(var c in this._digraph.listOfArcs)a=this._digraph.listOfArcs[c].getAmperage(),a.addEventListener(d.CHANGE_VALUE,b(this))},h.prototype._listenerValue=function(a){this._listOfChanged.push(a.target)},h.prototype._removeListeners=function(){for(var a in this._digraph.listOfArcs)a.removeListener(d.CHANGE_VALUE,b)},h.prototype.setBaseAmperage=function(a){this._baseAmperage=a,this._visualState!=h.VISUAL_NONE&&this.update(!0)},h.prototype.setDeltaDistance=function(a){if(this._visualState!=h.VISUAL_NONE)throw new c("Cannot set delta distance after start visusalization");this._deltaDistance=a},h.VISUAL_NONE="none",h.VISUAL_STARTED="Started",h.VISUAL_STOPPED="Stopped",h.VISUAL_PAUSED="Paused",h.VISUAL_ERROR="Error";for(var i in g)h.prototype[i]=g[i]}();
//# sourceMappingURL=CircuitViz-1.0.0.min.js.map